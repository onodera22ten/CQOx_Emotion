# Emotion CQOx - Emotional Episode Optimizer

**ä¸€è¨€ã§è¨€ã†ã¨**: Google / Netflix / Meta / BCG / WPP ã®ãƒˆãƒƒãƒ—ãƒãƒ¼ãƒ ãŒå†…è£½ã—ã¦ã„ã‚‹"å› æœãƒ™ãƒ¼ã‚¹ã®æ„æ€æ±ºå®šã‚³ãƒ³ã‚½ãƒ¼ãƒ«"ã‚’ã€ä¸€èˆ¬ä¼æ¥­ã§ã‚‚ä½¿ãˆã‚‹å½¢ã«è½ã¨ã—è¾¼ã‚“ã ã‚‚ã® + æ„Ÿæƒ…ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹é ˜åŸŸã¸ã®ç‰¹åŒ–

> ã€Œé¢æ¥ãƒ»1on1ãƒ»å¤§äº‹ãªè©±ã—åˆã„ã€ãªã©ã®æ„Ÿæƒ…è² è·ã®é«˜ã„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã”ã¨ã«ã€äº‹å‰æº–å‚™ã¨çµæœã‚’ãƒ­ã‚°ã—ã€æœ¬äººã«ã¨ã£ã¦"æ¥½ã§ã€ã¡ã‚ƒã‚“ã¨ä¼ãˆã‚‰ã‚Œã‚‹"æº–å‚™ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®éåŒ»ç™‚ãƒ»éè¨ºæ–­ã®æ„æ€æ±ºå®šæ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

---

## ğŸ“Š What is Emotion CQOx?

Emotion CQOxã¯ã€**ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰(Episode) ãƒ™ãƒ¼ã‚¹ã®å› æœæ¨è«–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã§ã™ã€‚

### ä¸­æ ¸æ¦‚å¿µ

```
Episode = 1å›ã®å‡ºæ¥äº‹ (é¢æ¥ãƒ»1on1ãƒ»è©±ã—åˆã„ etc.)
  â”œâ”€â”€ Preparation: äº‹å‰æº–å‚™ (ã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°ãƒ»å‘¼å¸æ³•ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ etc.)
  â”œâ”€â”€ Outcome: å½“æ—¥ã®çµæœ (ã‚¹ãƒˆãƒ¬ã‚¹ãƒ»æ¶™ãƒ»ä¼é”åº¦ãƒ»é–¢ä¿‚ã¸ã®å½±éŸ¿)
  â””â”€â”€ Reflection: å¾Œæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š
```

**ç›®çš„**:
- ã€Œè‡ªåˆ†ã®æƒ³ã„ã‚’è©±ãã†ã¨ã™ã‚‹ã¨æ¶™ãŒå‡ºã‚‹ / å›ºã¾ã‚‹ã€äººãŒ
- ã©ã‚“ãªæ¡ä»¶ãƒ»è©±é¡Œãƒ»æº–å‚™ã§ãã†ãªã‚Šã‚„ã™ã„ã‹ã‚’å¯è¦–åŒ–ã—
- ã€Œè‡ªåˆ†ã«åˆã†æº–å‚™ãƒ»è¨€ã„æ–¹ãƒ»ãƒšãƒ¼ã‚¹é…åˆ†ã€ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒ–ã™ã‚‹

### What Makes It Different?

1. **éåŒ»ç™‚ãƒ»éè¨ºæ–­**
   è¨ºæ–­ã‚„æ²»ç™‚ã¯ä¸€åˆ‡è¡Œã‚ãªã„ã€‚ã‚ãã¾ã§ã€Œè‡ªåˆ†ã®å®Ÿé¨“ãƒ­ã‚°ã€ã¨ã—ã¦ä½¿ã†ã€‚

2. **å› æœã®è¨€èªã§èª¬æ˜**
   ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° CQOx ã¨åŒã˜ã€ŒÎ”Stressã€ã€ŒÎ”Expressionã€ã€ŒCAS (Causal Assurance Score)ã€ã§æº–å‚™åŠ¹æœã‚’æç¤ºã€‚

3. **å¤šç›®çš„æœ€é©åŒ–**
   ã€Œæ¶™ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ã€ã§ã¯ãªãã€ã€Œæ¥½ã• Ã— ä¼é”åº¦ Ã— é–¢ä¿‚æ€§ã€ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æœ¬äººãŒæ±ºã‚ã‚‹ã€‚

4. **ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UI**
   - Layer A: Episodeç›´å‰ã®çŠ¶æ…‹ (ã—ã‚“ã©ã•ãƒ»æ³£ããã†åº¦ãƒ»è©°ã¾ã‚Šãã†åº¦)
   - Layer B: æœ¬äººã®ç›®çš„é–¢æ•° (æ¥½ã•é‡è¦– vs ä¼ãˆãŸã„ vs é–¢ä¿‚ç¶­æŒ)
   - Layer C: What-if ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (æº–å‚™ãƒ—ãƒ©ãƒ³ã®äºˆæ¸¬)

---

## ğŸš€ Quick Start

### 1. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install pandas numpy scipy

# 5000è¡Œã®ã‚µãƒ³ãƒ—ãƒ«CSVç”Ÿæˆ
python scripts/generate_emotion_cqox_sample.py \
  --n-rows 5000 \
  --seed 42 \
  --output sample/emotion_cqox_sample_5000.csv
```

ç”Ÿæˆã•ã‚Œã‚‹CSV:
- **5000è¡Œ** = 5000ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰
- **25åˆ—** = äº‹å‰çŠ¶æ…‹ãƒ»æº–å‚™ãƒ»ã‚¢ã‚¦ãƒˆã‚«ãƒ ãƒ»æŒ¯ã‚Šè¿”ã‚Š
- **æ“¬ä¼¼å› æœæ§‹é€ ** = æº–å‚™ â†’ ã‚¹ãƒˆãƒ¬ã‚¹è»½æ¸› / è¡¨ç¾å‘ä¸Šã®é–¢ä¿‚ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹
- **ç¾å®Ÿçš„ãªæ¬ æ** = cancelled/planned ã¯ outcome ãŒç©ºã€70%ã ã‘ reflection ã‚ã‚Š

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•

```bash
cd backend
pip install -r requirements.txt

# PostgreSQL ã‚’èµ·å‹• (Dockeræ¨å¥¨)
docker run -d \
  --name emotion-cqox-db \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=emotion_cqox \
  -p 5432:5432 \
  postgres:15

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
alembic upgrade head

# FastAPI ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
uvicorn cqox.main:app --reload --host 0.0.0.0 --port 8000
```

API: `http://localhost:8000`
Docs: `http://localhost:8000/docs`

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•

```bash
cd frontend
npm install
npm run dev
```

UI: `http://localhost:5173`

---

## ğŸ“ Project Structure

```
CQOx_Emotion/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ cqox/
â”‚   â”‚   â”œâ”€â”€ emotion/
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py          # SQLAlchemy models
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py         # Pydantic schemas (3-layer sliders)
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.py       # Î” Calculations & Bandit
â”‚   â”‚   â”‚   â”œâ”€â”€ safety.py          # High-risk text detection
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ emotion.py         # FastAPI endpoints
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ alembic/                   # DB migrations
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ features/emotion/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EpisodeQuickSliders.tsx        # Layer A
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PreferenceSliders.tsx          # Layer B
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PreparationSimulator.tsx       # Layer C
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CausalEffectForestChart.tsx    # ATE å¯è¦–åŒ–
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EmotionTimelineChart.tsx       # æ™‚ç³»åˆ—å¯è¦–åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ pages/emotion/
â”‚   â”‚   â”‚       â”œâ”€â”€ EmotionEpisodeCreatePage.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ EmotionOutcomeLogPage.tsx
â”‚   â”‚   â”‚       â””â”€â”€ EmotionDashboardPage.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ generate_emotion_cqox_sample.py   # CSV generator
â”‚
â”œâ”€â”€ sample/
â”‚   â””â”€â”€ emotion_cqox_sample_5000.csv      # Generated data
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ SPEC.md                   # Full specification (from PDF)
â”‚   â””â”€â”€ API.md                    # API documentation
â”‚
â””â”€â”€ README.md                     # This file
```

---

## ğŸ”§ Core Features

### 1. Episode Management

**ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç™»éŒ²**: é¢æ¥ãƒ»1on1ãƒ»è©±ã—åˆã„ã‚’äº‹å‰/äº‹å¾Œã«è¨˜éŒ²

```typescript
// çŠ¶æ…‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ (Layer A)
<EpisodeQuickSliders
  preAnxiety={7}           // 0-10
  preCryingRisk={6}        // 0-10
  preSpeechBlockRisk={8}   // 0-10
  onChange={setPre}
/>
```

### 2. Preparation Templates

5ã¤ã®æº–å‚™ãƒ‘ã‚¿ãƒ¼ãƒ³:
- `journaling_10m`: 10åˆ†ã®æ›¸ãå‡ºã— (ã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°)
- `three_messages`: ä¼ãˆãŸã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’3ã¤æ±ºã‚ã‚‹
- `breathing_4_7_8`: 4-7-8å‘¼å¸æ³•
- `roleplay_self_qa`: è‡ªåˆ†ã§Q&Aãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤
- `safe_word_plan`: ã‚»ãƒ¼ãƒ•ãƒ¯ãƒ¼ãƒ‰ (ã¤ã‚‰ããªã£ãŸæ™‚ã®åˆå›³) ã‚’æ±ºã‚ã‚‹

### 3. Analytics Engine

**Î”Stress**: `pre_anxiety - stress_after`
**Î”Expression**: `expression_score` ã®å¤‰åŒ–

```python
from cqox.emotion.analytics import AnalyticsEngine

engine = AnalyticsEngine()
effect = engine.analyze_preparation_effect(
    template_key="journaling_10m",
    scenario_type="interview",
    all_episodes=episodes
)

print(f"Î”Stress: {effect.delta_stress.mean} ({effect.delta_stress.ci95})")
print(f"Î”Expression: {effect.delta_expression.mean}")
print(f"Confidence: {effect.confidence_label}")
```

### 4. Preference Profile (Slider Layer B)

**ç›®çš„é–¢æ•°ã‚’æœ¬äººãŒæ±ºã‚ã‚‹**:

```typescript
<PreferenceSliders
  relief={5}           // æ¥½ã•é‡è¦–åº¦ (0-10)
  expression={7}       // ä¼ãˆãŸã„åº¦ (0-10)
  relationship={3}     // é–¢ä¿‚ç¶­æŒåº¦ (0-10)
  onChange={setPrefs}
/>
```

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å ±é…¬é–¢æ•°ã«çµ„ã¿è¾¼ã¿:

```python
total_reward = (
    w_relief * relief_reward
    + w_expression * expression_reward
    + w_relationship * relationship_reward
)
```

### 5. What-if Simulation (Slider Layer C)

**æº–å‚™ãƒ—ãƒ©ãƒ³ã®äºˆæ¸¬**:

```bash
POST /api/emotion/simulate
{
  "pre_anxiety": 7,
  "prep_journaling_10m": 8,
  "prep_three_messages": 6
}

Response:
{
  "predicted_stress_after": {"mean": 4.2, "ci95": [2.1, 6.3]},
  "predicted_expression_score": {"mean": 6.5, "ci95": [4.0, 9.0]},
  "total_reward": 0.72,
  "disclaimer": "This is a prediction based on your past data..."
}
```

### 6. Safety Guardrails

**ãƒã‚¤ãƒªã‚¹ã‚¯ãƒ†ã‚­ã‚¹ãƒˆæ¤œçŸ¥**:

```python
from cqox.emotion.safety import SafetyGuard

guard = SafetyGuard()
result = guard.check_text("æ­»ã«ãŸã„ã¨æ€ã†ã“ã¨ãŒã‚ã‚‹")

# result.is_safe = False
# result.risk_level = "critical"
# result.resources = [ã„ã®ã¡ã®é›»è©±, ã“ã“ã‚ã®å¥åº·ç›¸è«‡çµ±ä¸€ãƒ€ã‚¤ãƒ¤ãƒ«, ...]
```

æ¤œçŸ¥ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯:
- **LLMã«é€ä¿¡ã—ãªã„**
- ãƒãƒƒã‚·ãƒ¥ã®ã¿ãƒ­ã‚°ä¿å­˜
- å°‚é–€æ©Ÿé–¢ãƒªã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤º
- **åˆ©ç”¨ç¶™ç¶šã§ã¯ãªãé›¢è„±ã‚’ä¿ƒã™**

---

## ğŸ“Š Sample CSV Structure

| åˆ—å | å‹ | èª¬æ˜ | æ¬ æ |
|------|-----|------|------|
| `episode_id` | int | ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ID (1-5000) | ãªã— |
| `user_id` | int | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (1-30, 1-5ã¯ãƒ˜ãƒ“ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼) | ãªã— |
| `status` | str | completed / planned / cancelled | ãªã— |
| `scenario_type` | str | interview / one_on_one / partner / family / friend / client / other | ãªã— |
| `topic` | str | ã€Œè»¢è·ç†ç”±ã€ã€Œåˆ¥ã‚Œè©±ã€ãªã© | ãªã— |
| `scheduled_at` | str | ISO8601 (éå»2å¹´ã€œæœªæ¥3ã‹æœˆ) | ãªã— |
| `pre_anxiety` | int | 0-10 | ãªã— |
| `pre_crying_risk` | int | 0-10 | ãªã— |
| `pre_speech_block_risk` | int | 0-10 | ãªã— |
| `prep_journaling_10m_intensity` | int or "" | 0-10, 0ã¯ç©ºæ–‡å­— | ã‚ã‚Š |
| `prep_three_messages_intensity` | int or "" | 0-10 | ã‚ã‚Š |
| `prep_breathing_4_7_8_intensity` | int or "" | 0-10 | ã‚ã‚Š |
| `prep_roleplay_self_qa_intensity` | int or "" | 0-10 | ã‚ã‚Š |
| `prep_safe_word_plan_intensity` | int or "" | 0-10 | ã‚ã‚Š |
| `stress_during` | int or "" | 0-10, completed ã®ã¿ | ã‚ã‚Š |
| `stress_after` | int or "" | 0-10, completed ã®ã¿ | ã‚ã‚Š |
| `crying_level` | int or "" | 0-10 | ã‚ã‚Š |
| `speech_block_level` | int or "" | 0-10 | ã‚ã‚Š |
| `expression_score` | int or "" | 0-10 | ã‚ã‚Š |
| `relationship_impact` | int or "" | -5 to +5 | ã‚ã‚Š |
| `partner_reaction` | str or "" | very_positive / positive / neutral / negative / very_negative / unknown | ã‚ã‚Š |
| `days_after_reflection` | int or "" | 1-14 | ã‚ã‚Š |
| `would_repeat_preparation` | int or "" | 0-10 | ã‚ã‚Š |
| `reflection_short` | str or "" | æ—¥æœ¬èªçŸ­æ–‡ | ã‚ã‚Š |

**é‡è¦**:
- æ•°å€¤ã§ã‚‚ã€Œæœªå®Ÿæ–½ãƒ»æœªè¨˜éŒ²ã€ã¯ `0` ã§ã¯ãªã `""`ï¼ˆç©ºæ–‡å­—ï¼‰
- `status` ã«ã‚ˆã£ã¦ã‚¢ã‚¦ãƒˆã‚«ãƒ åˆ—ãŒç³»çµ±çš„ã«æ¬ æ â†’ MNAR (Missing Not At Random)

---

## ğŸ¯ API Endpoints

### Episodes

```bash
POST   /api/emotion/scenarios              # Create episode
GET    /api/emotion/scenarios              # List episodes
GET    /api/emotion/scenarios/{id}         # Get episode detail
POST   /api/emotion/scenarios/{id}/preparations  # Add preparation
POST   /api/emotion/scenarios/{id}/outcomes     # Record outcome
POST   /api/emotion/scenarios/{id}/reflections  # Add reflection
```

### Analytics

```bash
GET    /api/emotion/dashboard/summary      # Dashboard summary with Î”Stress/Î”Expression
```

### Preference Profile

```bash
GET    /api/emotion/preferences/me         # Get my preferences
POST   /api/emotion/preferences/me         # Update preferences
```

### Safety

```bash
POST   /api/emotion/safety/check           # Check text for high-risk content
```

### Simulation

```bash
POST   /api/emotion/simulate               # Predict outcomes for preparation plan
```

### Import/Export

```bash
POST   /api/emotion/import/csv             # Import episodes from CSV
GET    /api/emotion/export/csv             # Export to CSV
```

---

## ğŸ”¬ Causal Inference Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Episode Log    â”‚
â”‚ (Pre + Prep +   â”‚
â”‚  Outcome +      â”‚
â”‚  Reflection)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Within-Subject  â”‚
â”‚   Comparison    â”‚
â”‚ (with prep vs   â”‚
â”‚  without prep)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Î”Stress        â”‚
â”‚  Î”Expression    â”‚
â”‚  + CI (95%)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Recommendation  â”‚
â”‚ (Contextual     â”‚
â”‚  Bandit)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Safety & Ethics

### Boundary Conditions

**ã‚„ã‚‹ã“ã¨**:
- å€‹äººãƒ¬ãƒ™ãƒ«ã®å®Ÿé¨“ãƒ­ã‚°ãƒ»å¯è¦–åŒ–
- æº–å‚™ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŠ¹æœæ¨å®šï¼ˆå› æœã®è¨€èªã§ï¼‰
- ãƒã‚¤ãƒªã‚¹ã‚¯æ¤œçŸ¥ â†’ å°‚é–€æ©Ÿé–¢ã¸ã®èª˜å°

**ã‚„ã‚‰ãªã„ã“ã¨** (æ˜ç¤ºçš„ã«):
- ã†ã¤ç—…ãƒ»PTSDç­‰ã®è¨ºæ–­ãƒ»è©•ä¾¡
- åŒ»ç™‚å°‚é–€å®¶ã®åˆ¤æ–­ã‚’ä»£æ›¿ã™ã‚‹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- è‡ªæ®ºãƒªã‚¹ã‚¯äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®è‡ªå‹•é‹ç”¨
- ã€Œæ¶™ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ã€å˜ä¸€ç›®çš„æœ€é©åŒ–

### High-Risk Detection

```python
# backend/cqox/emotion/safety.py

class SafetyGuard:
    critical_patterns = [
        r'æ­»ã«ãŸã„',
        r'è‡ªæ®º',
        r'æ¶ˆãˆãŸã„',
        ...
    ]

    def check_text(self, text: str) -> SafetyCheckResponse:
        # Detect patterns
        # Provide resources
        # Log (hash only, NOT the text itself)
        pass
```

**ãƒã‚¤ãƒªã‚¹ã‚¯æ¤œçŸ¥æ™‚ã®å‹•ä½œ**:
1. LLMã¸ã®é€ä¿¡ç¦æ­¢
2. å°‚é–€çª“å£ãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤º (ã„ã®ã¡ã®é›»è©±ãƒ»åšåŠ´çœSNSç›¸è«‡ç­‰)
3. **åˆ©ç”¨ç¶™ç¶šã§ã¯ãªãé›¢è„±ã‚’ä¿ƒã™**

---

## ğŸŒ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  User Interface (React)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Episode Quick  â”‚  â”‚  Preference    â”‚  â”‚ Simulation â”‚ â”‚
â”‚  â”‚   Sliders      â”‚  â”‚   Sliders      â”‚  â”‚   Panel    â”‚ â”‚
â”‚  â”‚  (Layer A)     â”‚  â”‚  (Layer B)     â”‚  â”‚ (Layer C)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Application Backend (FastAPI)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Emotion API â”‚  â”‚  Analytics   â”‚  â”‚ Safety Guard   â”‚ â”‚
â”‚  â”‚             â”‚  â”‚   Engine     â”‚  â”‚                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Infrastructure                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ Redis Cache â”‚  â”‚ S3/MinIO       â”‚ â”‚
â”‚  â”‚ (TimescaleDB)â”‚  â”‚             â”‚  â”‚ (optional)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Development Workflow

### 1. Backend Development

```bash
cd backend
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

# Run tests
pytest tests/emotion/

# Start dev server
uvicorn cqox.main:app --reload
```

### 2. Frontend Development

```bash
cd frontend
npm install
npm run dev

# Build for production
npm run build
```

### 3. Database Migrations

```bash
cd backend

# Create migration
alembic revision --autogenerate -m "add emotion tables"

# Apply migration
alembic upgrade head

# Rollback
alembic downgrade -1
```

---

## ğŸ“– Documentation

- **[Full Specification](./docs/SPEC.md)** - å®Œå…¨ãªä»•æ§˜æ›¸ (PDF ã‹ã‚‰å¤‰æ›)
- **[API Documentation](./docs/API.md)** - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°
- **[Frontend Components](./frontend/README.md)** - React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¬ã‚¤ãƒ‰
- **[Data Generation](./scripts/README.md)** - CSV ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯è©³ç´°

---

## ğŸ“ Use Cases

### 1. è»¢è·é¢æ¥ã®æº–å‚™

> ã€Œé¢æ¥ã§é€€è·ç†ç”±ã‚’èã‹ã‚Œã‚‹ã¨æ¯å›æ³£ã„ã¦ã—ã¾ã†ã€

**ä½¿ã„æ–¹**:
1. é¢æ¥å‰ã«çŠ¶æ…‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å…¥åŠ› (ä¸å®‰åº¦ãƒ»æ³£ããã†åº¦)
2. æº–å‚™ãƒ—ãƒ©ãƒ³ (ã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°ãƒ»3ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸) ã‚’é¸æŠ
3. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§äºˆæ¸¬ã‚’ç¢ºèª
4. é¢æ¥å¾Œã«ã‚¢ã‚¦ãƒˆã‚«ãƒ ã‚’è¨˜éŒ² (å®Ÿéš›ã®æ¶™ãƒ»ä¼é”åº¦)
5. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Œã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°ã‚’ã—ãŸæ™‚ã¨ã—ãªã„æ™‚ã®å·®ã€ã‚’ç¢ºèª

### 2. ä¸Šå¸ã¨ã®1on1

> ã€Œè©•ä¾¡é¢è«‡ã§ä¸æº€ã‚’ä¼ãˆãŸã„ãŒã€è¨€è‘‰ãŒè©°ã¾ã£ã¦ä¼ãˆã‚‰ã‚Œãªã„ã€

**ä½¿ã„æ–¹**:
1. ç›®çš„é–¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã€Œä¼ãˆãŸã„åº¦ã€ã‚’é«˜ã‚ã«è¨­å®š
2. ã€Œ3ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€æº–å‚™ã‚’é‡ç‚¹å®Ÿæ–½
3. ã‚¢ã‚¦ãƒˆã‚«ãƒ ã§ expression_score ã‚’è¨˜éŒ²
4. åˆ†æ: three_messages ãŒ expression_score ã«ã©ã‚Œãã‚‰ã„åŠ¹ã„ã¦ã„ã‚‹ã‹ç¢ºèª

### 3. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã®å¤§äº‹ãªè©±

> ã€ŒãŠé‡‘ã‚„å°†æ¥ã®è©±ã‚’ã™ã‚‹ã¨ã€é–¢ä¿‚ãŒæ‚ªããªã‚Šãã†ã§æ€–ã„ã€

**ä½¿ã„æ–¹**:
1. ç›®çš„é–¢æ•°ã§ã€Œé–¢ä¿‚ç¶­æŒã€ã‚’æœ€å„ªå…ˆã«è¨­å®š
2. ã‚»ãƒ¼ãƒ•ãƒ¯ãƒ¼ãƒ‰ (ã¤ã‚‰ããªã£ãŸæ™‚ã®åˆå›³) ã‚’äº‹å‰ã«æ±ºã‚ã‚‹
3. relationship_impact ã‚’è¨˜éŒ²
4. ã€Œé–¢ä¿‚ã‚’å£Šã•ãšã«æœ¬éŸ³ã‚’ä¼ãˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’æ¢ç´¢

---

## ğŸ¤ Contributing

Issues and PRs are welcome!

**é–‹ç™ºã®å„ªå…ˆé †ä½**:
1. å®‰å…¨æ€§ãƒ»å€«ç†ã®æ”¹å–„ (Safety module ã®ç²¾åº¦å‘ä¸Š)
2. åˆ†æã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ‹¡å¼µ (Causal Forest, Synthetic Control ãªã©)
3. UI/UX ã®æ”¹å–„ (ç‰¹ã«ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®åˆ†ã‹ã‚Šã‚„ã™ã•)
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ä¾‹ã®è¿½åŠ 

---

## ğŸ“œ License

MIT License

---

## ğŸ™ Acknowledgments

- **CQOx_gen** - ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã—ã¦åˆ©ç”¨
- **EconML / DoWhy** - å› æœæ¨è«–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å‚è€ƒå®Ÿè£…
- **ã„ã®ã¡ã®é›»è©±** - å®‰å…¨ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦æ²è¼‰

---

## âš ï¸ Disclaimer

Emotion CQOx is **NOT a medical device** and does **NOT provide diagnosis or treatment**.
If you are experiencing severe distress or suicidal thoughts, please contact professional resources immediately:

- **ã„ã®ã¡ã®é›»è©±**: 0570-783-556 (24æ™‚é–“)
- **ã“ã“ã‚ã®å¥åº·ç›¸è«‡çµ±ä¸€ãƒ€ã‚¤ãƒ¤ãƒ«**: 0570-064-556
- **Emergency**: 119 (Japan)

---

**Made with â¤ï¸ for people who want to express themselves calmly**
